<!DOCTYPE html>
<html lang="en" >
<head>
<meta charset="UTF-8">
<title>File Builder</title>






    <!-- Font Awesome -->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
<!-- Bootstrap core CSS -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
<!-- Material Design Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.8.10/css/mdb.min.css" rel="stylesheet">

<!-- habebna -->


<!-- JQuery -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<!-- Bootstrap tooltips -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
<!-- Bootstrap core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
<!-- MDB core JavaScript -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.8.10/js/mdb.min.js"></script>


<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>


<style>

body {
  font-size: 1em;
  background: #fafafa;
  font-family: Lato;
  font-weight: 300;
}




</style>

</head>
<body>
    
    <div style="margin-left: 1%;margin-top: 2%;width:40%">
      <h3>Build Auto Train File</h3>

      <div style="margin-top:3%;margin-left: 0%">
    <div style="float:right"> <button class="btn" style="margin-top: 22%;text-transform: none ;" onclick="downloadAutoTrainFile();"><i class="fa fa-download"></i> Download File</button></div>
    
    

    <form id="mainForm" >
    <div class="row" >
      <div class="col-12">
        <header>
          <p>Add Models In Order <bold>(ORDER MUST RESPECT ANY DEPENDENCIES BETWEEN THE MODELS.)</bold></p>
        </header>
        <div class="input-group mb-3">
          <input id="userinput" type="text" class="form-control" placeholder="Model name" aria-label="Add an item" aria-describedby="basic-addon2" required>
          <div class="input-group-append">
            <!-- <button class="btn btn-outline-info" id="enter" type="button" style="margin-top: 0%">Add</button> -->
            <button type="submit" class="btn btn-primary btn-md" id="enter" style="margin-top: 0%;">Add</button>
            <a id="hiddenLink" style="visibility: hidden" download="auto_train.py" href=""></a>
          </div>
          
          
          
        </div>
      </div>
    </div>
    </form>
      </div>
</div>

      </div>
      <div class="col-12">
        <ul class="list-group">
          
        </ul>
      </div>
    </div>
  





  <!-- Scripts -->
  
</body>
<script>






$("#mainForm").submit(function(e) {  
    e.preventDefault();
});

function readTextFile(fileName) {
  
  var rawFile = new XMLHttpRequest();
  rawFile.open("GET", "./"+fileName, false);
  rawFile.onreadystatechange = function() {
    if (rawFile.readyState === 4) {
      var allText = rawFile.responseText;
      data= allText;
    }
  }
  rawFile.send();
  return data;
}


var button = document.getElementById("enter");
var input = document.getElementById("userinput");
var ul = document.querySelector("ul");


var staticFilePart =readTextFile("static.py")
var dynamicFilePart =readTextFile("dynamic.py")


// Create Base64 Object
var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,u,a;var f=0;e=Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){var t="";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){var t="";var n=0;var r=c1=c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}}

base64HrefInit="data:application/octet-stream;charset=utf-16le;base64,"



button.addEventListener("click", function() {
    if (input.value.match(/^[a-zA-Z_][a-zA-Z0-9_]*$/)) {
    
    console.log("bazwwwwwddddd")
    var li = document.createElement("li");
    li.className = 'list-group-item';
    li.textContent = input.value;
    ul.appendChild(li);
    }else{
      alert("Invalid Model Name! A model's name must be a valid Python Class name.")
    }
});

function downloadAutoTrainFile(){
    
    if (ul.childElementCount==0){
        alert("You must add at least one model!")
        return 
    }

    fileStr=buildAutoTrainFileText();
    console.log(fileStr);
    var encodedString = Base64.encode(fileStr);
    

    var link=$("#hiddenLink");
    link.attr("href",base64HrefInit+encodedString)
    link[0].click();


}
    
    


function buildAutoTrainFileText(){
    fileStr=staticFilePart;
    $("li").each(function () {
      fileStr+=dynamicFilePart.replace("MyModel", this.textContent) 
    }); 
    

    return fileStr
    
}

</script>
</html>